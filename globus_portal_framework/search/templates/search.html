{%extends "base.html"%}

{% load static %}

{%block title%}Search{%endblock%}

{%block headextras%}

<link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}" />

<script>
  /*
  This helper function ensures queries are inserted as the first query-param
  so that the search url is copy-pastable by the user
  */
  function customSearch(page={{ search.pagination.current_page|default:"1"}}) {
    //copy as a hidden field so we don't change the look of the page
    var page = $('<input>').attr({type: 'hidden', id: 'foo',
                                 name: 'page', value: page});
    var input = $('#search-input').clone().attr('type','hidden');
    $('#facet-form').prepend(page).prepend(input).submit();
  }
</script>

{%endblock%}

{%block body%}
  {%include "components/header.html"%}

<div class="container">

  <form id="search-form" class="my-4" name="search_form" action="/">
    <input type="text" id="search-input" autocomplete="off"
           data-provide="typeahead" name="q"
           value="{{request.session.search.query}}" placeholder="Start your search here">
    <button id="search-btn" type="submit" class="btn btn-default">
      <i class="fas fa-search"></i>
    </button>
  </form>

  <div class="row">
    <div id="sidebar" class="col-xs-12 col-sm-4 col-md-4">
      <div id="filters">
        <div id="facet-container">
          <form id="facet-form" action="/">
            {% include "components/search-facets.html" %}
          </form>
        </div>
      </div>
    </div>

    <div id="content" class="col-xs-12 col-sm-8 col-md-8">

      <div id="results" style="display: inline;">
        {% if not request.user.username %}
        <div class="well">NOTE: Your search results are limited. Logging in can improve search results by displaying private results if you have permissions associated with your account.
        </div>
        {% endif %}
        {% include "components/search-results.html" %}

        <nav aria-label="Search results pages" class="text-center">
          <ul id="pagination" class="pagination">
            {% for page in search.pagination.pages %}
            {% if page.number == search.pagination.current_page %}
            <li class="active">
            {% else %}
            <li>
            {% endif %}
              <a href="#" onclick="customSearch({{page.number}});">{{page.number}}</a>
            </li>
            {% endfor %}
          </ul>
        </nav>

      </div>
    </div>
  </div>
</div>
{% endblock %}
